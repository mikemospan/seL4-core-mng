<?xml version="1.0" ?>
<!--
     Copyright 2020, Data61, CSIRO (ABN 41 687 119 230)

     SPDX-License-Identifier: BSD-2-Clause
-->

<api name="ObjectApiAarch64" label_prefix="aarch64_">
    <struct name="seL4_UserContext">
        <member name="pc"/>
        <member name="sp"/>
        <member name="spsr"/>
        <member name="x0"/>
        <member name="x1"/>
        <member name="x2"/>
        <member name="x3"/>
        <member name="x4"/>
        <member name="x5"/>
        <member name="x6"/>
        <member name="x7"/>
        <member name="x8"/>
        <member name="x16"/>
        <member name="x17"/>
        <member name="x18"/>
        <member name="x29"/>
        <member name="x30"/>
        <member name="x9"/>
        <member name="x10"/>
        <member name="x11"/>
        <member name="x12"/>
        <member name="x13"/>
        <member name="x14"/>
        <member name="x15"/>
        <member name="x19"/>
        <member name="x20"/>
        <member name="x21"/>
        <member name="x22"/>
        <member name="x23"/>
        <member name="x24"/>
        <member name="x25"/>
        <member name="x26"/>
        <member name="x27"/>
        <member name="x28"/>
        <member name="tpidr_el0"/>
        <member name="tpidrro_el0"/>
    </struct>
    <struct name="seL4_ARM_SMCContext">
        <member name="x0"/>
        <member name="x1"/>
        <member name="x2"/>
        <member name="x3"/>
        <member name="x4"/>
        <member name="x5"/>
        <member name="x6"/>
        <member name="x7"/>
    </struct>
    <interface name="seL4_ARM_VSpace" manual_name="Page Global Directory"
        cap_description="Capability to the top level translation table being operated on.">
        <method id="ARMVSpaceClean_Data" name="Clean_Data" manual_label="vspace_clean"
            manual_name="Clean Data">
                <brief>
                    Clean cached pages within a top level translation table
                </brief>
                <description>
                    <docref>See <autoref label="ch:vspace"/>.</docref>
                </description>
            <param dir="in" name="start" type="seL4_Word"
            description="Start address"/>
            <param dir="in" name="end" type="seL4_Word"
            description="End address"/>
            <error name="seL4_FailedLookup">
                <description>
                    The <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="end"/> is in the kernel virtual address range.
                </description>
            </error>
            <error name="seL4_InvalidArgument">
                <description>
                    The <texttt text="start"/> is greater than or equal to <texttt text="end"/>.
                </description>
            </error>
            <error name="seL4_InvalidCapability">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The specified range crosses a page boundary.
                </description>
            </error>
        </method>
        <method id="ARMVSpaceInvalidate_Data" name="Invalidate_Data"
            manual_name="Invalidate Data" manual_label="vspace_invalidate">
                <brief>
                    Invalidate cached pages within a top level translation table
                </brief>
             <description>
                 <docref>See <autoref label="ch:vspace"/>.</docref>
             </description>
            <param dir="in" name="start" type="seL4_Word"
            description="Start address"/>
            <param dir="in" name="end" type="seL4_Word"
            description="End address"/>
            <error name="seL4_FailedLookup">
                <description>
                    The <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="end"/> is in the kernel virtual address range.
                </description>
            </error>
            <error name="seL4_InvalidArgument">
                <description>
                    The <texttt text="start"/> is greater than or equal to <texttt text="end"/>.
                </description>
            </error>
            <error name="seL4_InvalidCapability">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The specified range crosses a page boundary.
                </description>
            </error>
        </method>
        <method id="ARMVSpaceCleanInvalidate_Data" name="CleanInvalidate_Data"
            manual_name="Clean and Invalidate Data" manual_label="vspace_clean_invalidate">
                <brief>
                    Clean and invalidate cached pages within a top level translation table
                </brief>
             <description>
                 <docref>See <autoref label="ch:vspace"/>.</docref>
             </description>
            <param dir="in" name="start" type="seL4_Word"
            description="Start address"/>
            <param dir="in" name="end" type="seL4_Word"
            description="End address"/>
            <error name="seL4_FailedLookup">
                <description>
                    The <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="end"/> is in the kernel virtual address range.
                </description>
            </error>
            <error name="seL4_InvalidArgument">
                <description>
                    The <texttt text="start"/> is greater than or equal to <texttt text="end"/>.
                </description>
            </error>
            <error name="seL4_InvalidCapability">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The specified range crosses a page boundary.
                </description>
            </error>
        </method>
        <method id="ARMVSpaceUnify_Instruction" name="Unify_Instruction"
            manual_name="Unify Instruction" manual_label="vspace_unify_instruction">
                <brief>
                    Clean and invalidate cached instruction pages to point of unification
                </brief>
             <description>
                 <docref>See <autoref label="ch:vspace"/>.</docref>
             </description>
             <param dir="in" name="start" type="seL4_Word"
             description="Start address"/>
             <param dir="in" name="end" type="seL4_Word"
	     description="End address"/>
            <error name="seL4_FailedLookup">
                <description>
                    The <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="end"/> is in the kernel virtual address range.
                </description>
            </error>
            <error name="seL4_InvalidArgument">
                <description>
                    The <texttt text="start"/> is greater than or equal to <texttt text="end"/>.
                </description>
            </error>
            <error name="seL4_InvalidCapability">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                    Or, <texttt text="_service"/> is not assigned to an ASID pool.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The specified range crosses a page boundary.
                </description>
            </error>
        </method>
    </interface>
    <interface name="seL4_ARM_SMC" manual_name="SMC" cap_description="Capability to allow threads to make Secure Monitor Calls.">
        <method id="ARMSMCCall" name="Call" manual_name="SMC Call" manual_label="smc_call">
            <brief>
                Tell the kernel to make the real SMC call.
            </brief>
            <description>
                Takes x0-x7 as arguments to an SMC call which are defined as a seL4_ARM_SMCContext
                struct. The kernel makes the SMC call and then returns the results as a
                new seL4_ARM_SMCContext.
            </description>
            <param dir="in" name="smc_args" type="seL4_ARM_SMCContext"
                description="The structure that has the provided arguments."/>
            <param dir="out" name="smc_response" type="seL4_ARM_SMCContext"
                description="The structure to capture the responses."/>
        </method>
    </interface>

    <interface name="seL4_ARM_PMUControl" manual_name="PMU" cap_description="Capability to allow threads to access the Performance Monitoring Unit.">
        <method id="PMUReadEventCounter" name="ReadEventCounter" manual_name="ReadEventCounter" manual_label="pmucontrol_readeventcounter">
            <brief>
                Read the PMU counter associated with the specified input paramater.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="in" name="counter" type="seL4_Word"
                description="Hardware counter number you wish to read from."/>
            <param dir="out" name="counter_value" type="seL4_Word"
                description="Value read from the hardware counter." />
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The <texttt text="counter"/> less than 0, or greater than the number of hardware counters
                    present.
                </description>
            </error>
        </method>

        <method id="PMUWriteEventCounter" name="WriteEventCounter" manual_name="WriteEventCounter" manual_label="pmucontrol_writeeventcounter">
            <brief>
                Write the PMU counter value and event type associated with the specified input paramater.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="in" name="counter" type="seL4_Word"
                description="Hardware counter number you wish to write to."/>
            <param dir="in" name="counter_value" type="seL4_Word"
                description="Value you wish to set the hardware counter to."/>
            <param dir="in" name="event_type" type="seL4_Word"
                description="The micro-architectural event that you wish to count."/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The <texttt text="counter"/> less than 0, or greater than the number of hardware counters
                    present.
                </description>
            </error>
        </method>

        <method id="PMUReadCycleCounter" name="ReadCycleCounter" manual_name="ReadCycleCounter" manual_label="pmucontrol_readcyclecounter">
            <brief>
                Read the PMU cycle counter.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="out" name="cycle_counter_value" type="seL4_Word"
                description="Value read from the hardware counter." />
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
        </method>

        <method id="PMUWriteCycleCounter" name="WriteCycleCounter" manual_name="WriteCycleCounter" manual_label="pmucontrol_writecyclecounter">
            <brief>
                Write the PMU cycle counter value.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="in" name="counter_value" type="seL4_Word"
                description="Value you wish to set the hardware counter to."/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
        </method>

        <method id="PMUCounterControl" name="CounterControl" manual_name="CounterControl" manual_label="pmucontrol_countercontrol">
            <brief>
                Start, stop or reset the PMU.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="in" name="control" type="seL4_Word"
                description="This is the action we wish to control. 0 - stop, 1 - start, 2 - reset"/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The <texttt text="counter"/> less than 0, or greater than the number of hardware counters
                    present.
                </description>
            </error>
        </method>

        <method id="PMUReadInterruptValue" name="ReadInterruptValue" manual_name="ReadInterruptValue" manual_label="pmucontrol_readinterruptvalue">
            <brief>
                Get the interrupt value of the PMU.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="out" name="interrupt_val" type="seL4_Word"
                description="This is the return value of the interrupt value."/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
        </method>

        <method id="PMUWriteInterruptValue" name="WriteInterruptValue" manual_name="WriteInterruptValue" manual_label="pmucontrol_writeinterruptvalue">
            <brief>
                Write a value to the interrupt value register.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="in" name="interrupt_val" type="seL4_Word"
                description="This is the value that will be written to the interrupt value register"/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
        </method>

        <method id="PMUInterruptControl" name="InterruptControl" manual_name="InterruptControl" manual_label="pmucontrol_interruptcontrol">
            <brief>
                Set the value of the interrupt control register
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="in" name="interrupt_ctl" type="seL4_Word"
                description="The counters that you wish to enable interrupts for."/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
        </method>

        <method id="PMUNumCounters" name="NumCounters" manual_name="NumCounters" manual_label="pmucontrol_numcounters">
            <brief>
                Get the number of event counters available on this platform
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="out" name="num_counters" type="seL4_Word"
                description="This is the number of hardware performance counters read available, as read from the PMU."/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
        </method>

    </interface>

    <interface name="seL4_ARM_VPMU" manual_name="VPMU" cap_description="Virtual PMU object that mimics the underlying hardware">
        <method id="VPMUReadEventCounter" name="VPMUReadEventCounter" manual_name="VPMUReadEventCounter" manual_label="vpmucontrol_readeventcounter">
            <brief>
                Read the VPMU counter associated with the specified input paramater.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="in" name="counter" type="seL4_Word"
                description="Hardware counter number you wish to read from."/>
            <param dir="out" name="counter_value" type="seL4_Word"
                description="Value read from the hardware counter." />
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The <texttt text="counter"/> less than 0, or greater than the number of hardware counters
                    present.
                </description>
            </error>
        </method>

        <method id="VPMUWriteEventCounter" name="VPMUWriteEventCounter" manual_name="VPMUWriteEventCounter" manual_label="vpmucontrol_writeeventcounter">
            <brief>
                Write the VPMU counter value and event type associated with the specified input paramater.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="in" name="counter" type="seL4_Word"
                description="Hardware counter number you wish to write to."/>
            <param dir="in" name="counter_value" type="seL4_Word"
                description="Value you wish to set the hardware counter to."/>
            <param dir="in" name="event_type" type="seL4_Word"
                description="The micro-architectural event that you wish to count."/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The <texttt text="counter"/> less than 0, or greater than the number of hardware counters
                    present.
                </description>
            </error>
        </method>

        <method id="VPMUReadCycleCounter" name="VPMUReadCycleCounter" manual_name="VPMUReadCycleCounter" manual_label="vpmucontrol_readcyclecounter">
            <brief>
                Read the VPMU cycle counter.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="out" name="cycle_counter_value" type="seL4_Word"
                description="Value read from the hardware counter." />
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
        </method>

        <method id="VPMUWriteCycleCounter" name="VPMUWriteCycleCounter" manual_name="VPMUWriteCycleCounter" manual_label="vpmucontrol_writecyclecounter">
            <brief>
                Write to the VPMU cycle counter value.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="in" name="counter_value" type="seL4_Word"
                description="Value you wish to set the hardware counter to."/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
        </method>

        <method id="VPMUCounterControl" name="VPMUCounterControl" manual_name="VPMUCounterControl" manual_label="vpmucontrol_countercontrol">
            <brief>
                Start, stop or reset the VPMU.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="in" name="control" type="seL4_Word"
                description="This is the action we wish to control. 0 - stop, 1 - start, 2 - reset"/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
            <error name="seL4_RangeError">
                <description>
                    The <texttt text="counter"/> less than 0, or greater than the number of hardware counters
                    present.
                </description>
            </error>
        </method>

        <method id="VPMUReadInterruptValue" name="VPMUReadInterruptValue" manual_name="VPMUReadInterruptValue" manual_label="vpmucontrol_readinterruptvalue">
            <brief>
                Get the interrupt value of the VPMU.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="out" name="interrupt_val" type="seL4_Word"
                description="This is the return value of the interrupt value."/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
        </method>

        <method id="VPMUWriteInterruptValue" name="VPMUWriteInterruptValue" manual_name="VPMUWriteInterruptValue" manual_label="vpmucontrol_writeinterruptvalue">
            <brief>
                Write a value to the interrupt value register.
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="in" name="interrupt_val" type="seL4_Word"
                description="This is the value that will be written to the interrupt value register"/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
        </method>

        <method id="VPMUInterruptControl" name="VPMUInterruptControl" manual_name="VPMUInterruptControl" manual_label="vpmucontrol_interruptcontrol">
            <brief>
                Set the value of the interrupt control register
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="in" name="interrupt_ctl" type="seL4_Word"
                description="The counters that you wish to enable interrupts for."/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
        </method>

        <method id="VPMUNumCounters" name="VPMUNumCounters" manual_name="VPMUNumCounters" manual_label="vpmucontrol_numcounters">
            <brief>
                Get the number of event counters available on this platform
            </brief>
            <description>
                See <autoref label="sec:threads"/>
            </description>
            <return><errorenumdesc/></return>
            <param dir="out" name="num_counters" type="seL4_Word"
                description="This is the number of hardware performance counters read available, as read from the PMU."/>
            <error name="seL4_IllegalOperation">
                <description>
                    The <texttt text="_service"/> is a CPtr to a capability of the wrong type.
                </description>
            </error>
        </method>
    </interface>
</api>
